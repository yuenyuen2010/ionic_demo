import{u as R,r as o,j as e,I as _,b as B,c as h,e as T}from"./index-BLtOpwuz.js";import{o as G,v as q,E as U,F as z,r as F,h as D}from"./index-CEQkXYGf.js";import{C as J}from"./CommonHeader-CVm9cG9x.js";import{l as K}from"./lessons-DH3gilkg.js";const V=()=>{const n=[];return K.forEach(t=>{t.cards.forEach(i=>{i.tagalog.split(" ").length<=3&&n.push({tagalog:i.tagalog,english:i.english})})}),n},A=n=>{const t=[...n];for(let i=t.length-1;i>0;i--){const p=Math.floor(Math.random()*(i+1));[t[i],t[p]]=[t[p],t[i]]}return t},d=10,se=()=>{const{t:n}=R(),t=o.useRef(null),[i,p]=o.useState([]),[u,E]=o.useState(0),[x,I]=o.useState(0),[c,w]=o.useState(null),[g,y]=o.useState(null),[S,P]=o.useState(!1),[j,m]=o.useState(!1),[N,k]=o.useState(!1),W=o.useCallback(()=>{const s=V();return A(s).slice(0,d).map(b=>{const f=A(s.filter(Q=>Q.tagalog!==b.tagalog)).slice(0,3),v=A([b,...f]);return{word:b,options:v}})},[]),C=o.useCallback(()=>{const s=W();p(s),E(0),I(0),w(null),y(null),P(!1),k(!1)},[W]);o.useEffect(()=>{C()},[C]);const r=i[u],$=async()=>{var a;if(!r||j)return;m(!0),k(!0);const s=r.word.tagalog;console.log("Playing audio for:",s);try{const f=(a=(await(await fetch("/ionic_demo/audio/audio-map.json")).json())[s])==null?void 0:a.normal;if(console.log("Audio path found:",f),f){const v="/ionic_demo/".concat(f);if(console.log("Loading audio from:",v),t.current){t.current.src=v,t.current.onended=()=>m(!1),t.current.onerror=()=>{console.log("Local audio failed, trying Web Speech"),O(s)},await t.current.play();return}}else console.log("No local audio found, trying Web Speech")}catch(l){console.log("Audio map fetch failed:",l)}O(s)},O=s=>{if("speechSynthesis"in window){const a=new SpeechSynthesisUtterance(s);a.lang="fil-PH",a.rate=.9,a.onend=()=>m(!1),a.onerror=()=>m(!1),window.speechSynthesis.speak(a)}else console.log("Web Speech not supported"),m(!1)};o.useEffect(()=>{if(r&&!S){const s=setTimeout(()=>{$()},500);return()=>clearTimeout(s)}},[u,i]);const H=s=>{if(c!==null||!N)return;w(s);const a=s===r.word.tagalog;y(a),a&&I(l=>l+1),setTimeout(()=>{u+1>=d?P(!0):(E(l=>l+1),w(null),y(null),k(!1))},2e3)},L=()=>{const s=x/d*100;return s===100?"üèÜ":s>=80?"üåü":s>=60?"üòä":s>=40?"üí™":"üìö"},M=()=>{const s=x/d*100;return s===100?n("listening.perfect"):s>=80?n("listening.excellent"):s>=60?n("listening.good"):s>=40?n("listening.keepLearning"):n("listening.tryAgain")};return!r&&!S?null:e.jsxs(_,{children:[e.jsx(J,{title:n("listening.title"),showBackButton:!0,defaultHref:"/home"}),e.jsx("audio",{ref:t}),e.jsx(B,{className:"listening-game-content",children:S?e.jsx("div",{className:"listening-game-over",children:e.jsxs("div",{className:"game-over-card",children:[e.jsx("div",{className:"score-emoji",children:L()}),e.jsx("h2",{className:"score-title",children:M()}),e.jsx("div",{className:"final-score",children:e.jsxs("div",{className:"score-circle",children:[e.jsx("span",{className:"score-number",children:x}),e.jsxs("span",{className:"score-total",children:["/ ",d]})]})}),e.jsxs("div",{className:"game-over-actions",children:[e.jsxs(T,{expand:"block",onClick:C,className:"play-again-btn",children:[e.jsx(h,{icon:F,slot:"start"}),n("listening.playAgain")]}),e.jsxs(T,{expand:"block",fill:"outline",routerLink:"/home",className:"home-btn",children:[e.jsx(h,{icon:D,slot:"start"}),n("common.backToHome")]})]})]})}):e.jsxs("div",{className:"listening-game-container",children:[e.jsx("div",{className:"listening-progress-bar",children:e.jsx("div",{className:"listening-progress-fill",style:{width:"".concat((u+1)/d*100,"%")}})}),e.jsxs("div",{className:"listening-stats-row",children:[e.jsxs("div",{className:"listening-stat",children:[e.jsx("span",{className:"stat-label",children:n("listening.question")}),e.jsxs("span",{className:"stat-value",children:[u+1,"/",d]})]}),e.jsxs("div",{className:"listening-stat",children:[e.jsx("span",{className:"stat-label",children:n("listening.score")}),e.jsx("span",{className:"stat-value",children:x})]})]}),e.jsxs("div",{className:"audio-player-card",children:[e.jsx("button",{className:"play-audio-btn ".concat(j?"playing":""),onClick:$,disabled:j,children:e.jsx(h,{icon:j?G:q})}),e.jsx("p",{className:"audio-hint",children:n(N?"listening.tapAgain":"listening.tapToListen")})]}),e.jsx("div",{className:"listening-options-grid",children:r.options.map((s,a)=>{let l="listening-option";return c!==null&&(s.tagalog===r.word.tagalog?l+=" correct":s.tagalog===c&&!g?l+=" wrong":l+=" faded"),N||(l+=" disabled"),e.jsxs("button",{className:l,onClick:()=>H(s.tagalog),disabled:c!==null||!N,children:[e.jsx("span",{className:"option-tagalog",children:s.tagalog}),e.jsx("span",{className:"option-english",children:s.english}),c!==null&&s.tagalog===r.word.tagalog&&e.jsx(h,{icon:U,className:"result-icon correct"}),c===s.tagalog&&!g&&e.jsx(h,{icon:z,className:"result-icon wrong"})]},a)})}),c!==null&&e.jsxs("div",{className:"listening-feedback ".concat(g?"correct":"wrong"),children:[e.jsx("span",{className:"feedback-emoji",children:g?"‚úÖ":"‚ùå"}),e.jsx("span",{className:"feedback-text",children:g?n("listening.correct"):"".concat(n("listening.wrong")," ").concat(r.word.tagalog)})]})]})})]})};export{se as default};

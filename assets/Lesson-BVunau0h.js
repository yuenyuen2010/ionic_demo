import{u as W,r as b,j as o,e as g,l as N,c as p}from"./index-CjpSagsd.js";import{v as P,u as $,w as F,b as L}from"./index-DfZ6wAXF.js";const T="tagalog_bookmarks",C=()=>{const s=localStorage.getItem(T);if(!s)return[];try{return JSON.parse(s)}catch(t){return console.warn("Failed to parse bookmarks",t),[]}},_=s=>C().includes(s),K=s=>{const t=C();t.includes(s)||(t.push(s),localStorage.setItem(T,JSON.stringify(t)))},G=s=>{const t=C(),k=t.indexOf(s);k!==-1&&(t.splice(k,1),localStorage.setItem(T,JSON.stringify(t)))},V=s=>_(s)?(G(s),!1):(K(s),!0),D=({id:s,tagalog:t,english:k,zhTW:J,zhCN:U,example:n})=>{const{t:x,i18n:E}=W(),[v,R]=b.useState(!1),[d,w]=b.useState(!1),[A,O]=b.useState(!1);b.useEffect(()=>{O(_(s))},[s]);const H=e=>{e.stopPropagation();const h=V(s);O(h)},y=(()=>{switch(E.language){case"zh-TW":return{text:J||k,lang:"zh-TW",example:(n==null?void 0:n.zhTW)||(n==null?void 0:n.english)};case"zh-CN":return{text:U||k,lang:"zh-CN",example:(n==null?void 0:n.zhCN)||(n==null?void 0:n.english)};default:return{text:k,lang:"en-US",example:n==null?void 0:n.english}}})(),B=e=>e.toLowerCase().replace(/[?!.,;:'"()\/\\]/g,"").replace(/\s+/g,"_").trim(),j=async(e,h,u)=>{if(e.stopPropagation(),!d){w(!0);try{if(u==="tl-PH"){try{const a=B(h),f="".concat("/ionic_demo/","audio/").concat(a,".mp3"),m=new Audio(f);await new Promise((S,I)=>{m.onended=()=>S(),m.onerror=()=>I("Local audio not found"),m.oncanplaythrough=()=>{m.play().catch(I)},m.load()});return}catch(a){console.warn("Local audio not found, trying online TTS",a)}try{const a=await fetch("https://tts-server-479744148035.asia-east1.run.app/tts",{method:"POST",headers:{"Content-Type":"application/json"},body:JSON.stringify({text:h,languageCode:"fil-PH",voiceName:"fil-PH-Standard-A"})});if(a.ok){const l=await a.json();if(l.audioContent){const f=new Audio("data:audio/mp3;base64,".concat(l.audioContent));await new Promise((m,S)=>{f.onended=()=>m(),f.onerror=()=>S("Audio playback failed"),f.play().catch(S)});return}}}catch(a){console.warn("Google Cloud TTS Serverless failed, falling back",a)}}let r=u;u==="tl-PH"&&(r="tl");const i="https://translate.google.com/translate_tts?ie=UTF-8&client=gtx&tl=".concat(r,"&q=").concat(encodeURIComponent(h)),c=new Audio(i);await new Promise((a,l)=>{c.onended=()=>a(),c.onerror=()=>l("Audio playback failed"),c.play().catch(l)})}catch(r){if(console.warn("Google TTS failed, falling back to Web Speech API",r),"speechSynthesis"in window){window.speechSynthesis.cancel();const i=new SpeechSynthesisUtterance(h);if(u==="tl-PH"){const a=window.speechSynthesis.getVoices().find(l=>l.lang==="tl-PH"||l.lang==="fil-PH"||l.name.includes("Tagalog")||l.name.includes("Filipino"));a&&(i.voice=a)}i.lang=u,i.rate=.9,await new Promise(c=>{i.onend=()=>c(),i.onerror=()=>c(),window.speechSynthesis.speak(i)})}}finally{w(!1)}}},z=async(e,h)=>{if(e.stopPropagation(),!d){w(!0);try{try{const r=B(h),c="".concat("/ionic_demo/","audio/").concat(r,"_slow.mp3"),a=new Audio(c);await new Promise((l,f)=>{a.onended=()=>l(),a.onerror=()=>f("Local slow audio not found"),a.oncanplaythrough=()=>{a.play().catch(f)},a.load()});return}catch(r){console.warn("Local slow audio not found, trying online TTS",r)}const u=await fetch("https://tts-server-479744148035.asia-east1.run.app/tts",{method:"POST",headers:{"Content-Type":"application/json"},body:JSON.stringify({text:h,languageCode:"fil-PH",voiceName:"fil-PH-Standard-A",speakingRate:.6})});if(u.ok){const r=await u.json();if(r.audioContent){const i=new Audio("data:audio/mp3;base64,".concat(r.audioContent));await new Promise((c,a)=>{i.onended=()=>c(),i.onerror=()=>a("Audio playback failed"),i.play().catch(a)})}}}catch(u){console.error("Slow TTS failed:",u)}finally{w(!1)}}};return o.jsx("div",{className:"flashcard-container ".concat(v?"flipped":""),onClick:()=>R(!v),children:o.jsxs("div",{className:"flashcard-inner",children:[o.jsxs("div",{className:"flashcard-front",children:[o.jsxs("div",{className:"audio-btn-group",children:[o.jsx(g,{fill:"clear",className:"audio-btn",onClick:e=>j(e,t,"tl-PH"),disabled:d,title:"Normal speed",children:d?o.jsx(N,{name:"dots",color:"primary"}):o.jsx(p,{icon:P,slot:"icon-only",color:"primary"})}),o.jsx(g,{fill:"clear",className:"slow-audio-btn",onClick:e=>z(e,t),disabled:d,title:"Slow speed (learner mode)",children:o.jsx(p,{icon:$,slot:"icon-only",color:"primary"})})]}),o.jsx(g,{fill:"clear",className:"bookmark-btn",onClick:H,children:o.jsx(p,{icon:A?F:L,slot:"icon-only",color:"primary"})}),o.jsx("h2",{children:t}),o.jsx("p",{className:"flip-hint",children:x("flashcard.tapToSeeTranslation")})]}),o.jsxs("div",{className:"flashcard-back",children:[o.jsx(g,{fill:"clear",className:"audio-btn",onClick:e=>j(e,y.text,y.lang),disabled:d,children:d?o.jsx(N,{name:"dots",color:"light"}):o.jsx(p,{icon:P,slot:"icon-only",color:"light"})}),o.jsx(g,{fill:"clear",className:"bookmark-btn",onClick:H,children:o.jsx(p,{icon:A?F:L,slot:"icon-only",color:"light"})}),o.jsx("h2",{children:y.text}),n&&o.jsxs("div",{className:"example-sentence",children:[o.jsxs("div",{className:"example-tagalog-row",children:[o.jsx("p",{className:"example-tagalog",children:n.tagalog}),o.jsxs("div",{className:"example-audio-group",children:[o.jsx(g,{fill:"clear",size:"small",className:"example-audio-btn",onClick:e=>j(e,n.tagalog,"tl-PH"),disabled:d,title:"Normal speed",children:d?o.jsx(N,{name:"dots",color:"medium"}):o.jsx(p,{icon:P,color:"medium"})}),o.jsx(g,{fill:"clear",size:"small",className:"example-audio-btn",onClick:e=>z(e,n.tagalog),disabled:d,title:"Slow speed",children:o.jsx(p,{icon:$,color:"medium"})})]})]}),o.jsx("p",{className:"example-translation",children:y.example})]}),!n&&o.jsx("p",{className:"flip-hint",children:x("flashcard.tapToSeeTagalog")})]})]})})};export{D as F,C as g};

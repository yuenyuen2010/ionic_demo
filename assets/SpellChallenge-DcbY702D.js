import{u as G,r as a,j as e,I as S,b as w,c as x,e as j,w as L}from"./index-DmI7GXTK.js";import{B as _,r as D,t as K,u as P,C as Q}from"./index-CEQkXYGf.js";import{C as y}from"./CommonHeader-CU3qHxhW.js";import{F as W}from"./Footer-CTd8jzlP.js";import{l as q}from"./lessons-DH3gilkg.js";const J=()=>q.flatMap(l=>l.cards),V=l=>{const n=[...l];for(let c=n.length-1;c>0;c--){const d=Math.floor(Math.random()*(c+1));[n[c],n[d]]=[n[d],n[c]]}return n},o=8,le=()=>{const{t:l,i18n:n}=G(),c=a.useMemo(()=>J(),[]),d=a.useRef(null),[h,H]=a.useState(0),[f,O]=a.useState(0),[g,N]=a.useState(""),[M,T]=a.useState(0),[m,v]=a.useState(!1),[t,b]=a.useState(null),[C,z]=a.useState([]),[k,B]=a.useState(!1),R=s=>{switch(n.language){case"zh-TW":return s.zhTW||s.english;case"zh-CN":return s.zhCN||s.english;default:return s.english}},E=()=>{const s=V(c).slice(0,o);z(s),H(0),O(0),N(""),T(0),v(!1),b(null),B(!1)};a.useEffect(()=>{E()},[]),a.useEffect(()=>{C.length>0&&!k&&t===null&&setTimeout(()=>{var s;(s=d.current)==null||s.setFocus()},100)},[h,C.length,k,t]);const r=C[h],U=s=>{const p=s.length;if(p<=2)return s[0]+"_";const u=Math.ceil(p/3);let i=s.substring(0,u);for(let I=u;I<p;I++)i+=s[I]===" "?" ":"_";return i},A=()=>{if(!r||t!==null)return;const s=r.tagalog.toLowerCase().trim(),u=g.toLowerCase().trim()===s;b(u?"correct":"incorrect"),u&&O(i=>i+(m?.5:1)),setTimeout(()=>{h+1>=o?B(!0):(H(i=>i+1),N(""),v(!1),b(null))},1500)},$=()=>{m||(v(!0),T(s=>s+1))},F=s=>{s.key==="Enter"&&t===null&&A()};if(k){const s=Math.round(f/o*100);return e.jsxs(S,{children:[e.jsx(y,{title:l("spell.title"),showBackButton:!0,defaultHref:"/home"}),e.jsx(w,{className:"ion-padding spell-content",children:e.jsxs("div",{className:"spell-over-container fade-in-up",children:[e.jsxs("div",{className:"spell-over-card",children:[e.jsx("div",{className:"trophy-icon",children:e.jsx(x,{icon:_})}),e.jsx("h2",{children:l("spell.complete")}),e.jsx("p",{className:"spell-over-subtitle",children:l("spell.greatSpelling")}),e.jsxs("div",{className:"score-grid",children:[e.jsxs("div",{className:"score-item",children:[e.jsx("div",{className:"score-label",children:l("game.finalScore")}),e.jsxs("div",{className:"score-value",children:[f,"/",o]})]}),e.jsxs("div",{className:"score-item",children:[e.jsx("div",{className:"score-label",children:l("game.accuracy")}),e.jsxs("div",{className:"score-value accent",children:[s,"%"]})]}),e.jsxs("div",{className:"score-item",children:[e.jsx("div",{className:"score-label",children:l("spell.hints")}),e.jsx("div",{className:"score-value streak",children:M})]})]}),e.jsxs(j,{expand:"block",className:"play-again-btn",onClick:E,children:[e.jsx(x,{icon:D,slot:"start"}),l("game.playAgain")]}),e.jsx(j,{expand:"block",fill:"outline",routerLink:"/home",className:"home-btn",children:l("review.backToHome")})]}),e.jsx(W,{})]})})]})}return r?e.jsxs(S,{children:[e.jsx(y,{title:l("spell.title"),showBackButton:!0,defaultHref:"/home"}),e.jsx(w,{className:"ion-padding spell-content",children:e.jsxs("div",{className:"spell-container",children:[e.jsxs("div",{className:"spell-progress",children:[e.jsx("div",{className:"progress-bar",children:e.jsx("div",{className:"progress-fill",style:{width:"".concat(h/o*100,"%")}})}),e.jsxs("div",{className:"progress-text",children:[h+1," / ",o]})]}),e.jsx("div",{className:"spell-stats",children:e.jsxs("div",{className:"stat-item",children:[e.jsx("span",{className:"stat-label",children:l("game.score")}),e.jsx("span",{className:"stat-value",children:f})]})}),e.jsxs("div",{className:"spell-card ".concat(t==="correct"?"correct":""," ").concat(t==="incorrect"?"incorrect":""),children:[e.jsx("div",{className:"spell-prompt-label",children:l("spell.typeTagalog")}),e.jsx("h2",{className:"spell-prompt",children:R(r)}),m&&e.jsxs("div",{className:"hint-display",children:[e.jsx("span",{className:"hint-label",children:l("spell.hintLabel")}),e.jsx("span",{className:"hint-text",children:U(r.tagalog)})]})]}),e.jsxs("div",{className:"input-area",children:[e.jsx(L,{ref:d,value:g,onIonInput:s=>N(s.detail.value||""),onKeyDown:F,placeholder:l("spell.placeholder"),className:"spell-input ".concat(t),disabled:t!==null,autocapitalize:"off",autocomplete:"off",spellcheck:!1}),t&&e.jsxs("div",{className:"feedback-display ".concat(t),children:[e.jsx(x,{icon:t==="correct"?K:P}),e.jsx("span",{children:t==="correct"?l("review.correct"):r.tagalog})]})]}),e.jsxs("div",{className:"action-buttons",children:[e.jsxs(j,{fill:"outline",onClick:$,disabled:m||t!==null,className:"hint-btn",children:[e.jsx(x,{icon:Q,slot:"start"}),l("spell.hint")]}),e.jsx(j,{onClick:A,disabled:!g.trim()||t!==null,className:"submit-btn",children:l("spell.submit")})]})]})})]}):e.jsxs(S,{children:[e.jsx(y,{title:l("spell.title"),showBackButton:!0,defaultHref:"/home"}),e.jsx(w,{className:"ion-padding spell-content",children:e.jsx("div",{className:"loading-container",children:e.jsx("p",{children:l("game.loading")})})})]})};export{le as default};

import{u as z,r as o,j as e,I as N,a as v,b as C,d as g}from"./index-CU99YgDY.js";import{y as A,r as G,s as R}from"./index-u5fJ2iny.js";import{C as k}from"./CommonHeader-DOi-p05U.js";import{F}from"./Footer-c8JWjoJG.js";import{l as U}from"./lessons-f0IG6bUd.js";const _=()=>U.flatMap(l=>l.cards),S=l=>{const c=[...l];for(let n=c.length-1;n>0;n--){const t=Math.floor(Math.random()*(n+1));[c[n],c[t]]=[c[t],c[n]]}return c},T=l=>{const c=l.split("");let n=S(c),t=0;for(;n.join("")===l&&t<10;)n=S(c),t++;return n},h=8,K=()=>{const{t:l,i18n:c}=z(),n=o.useMemo(()=>_(),[]),[t,w]=o.useState(0),[j,I]=o.useState(0),[x,y]=o.useState([]),[d,m]=o.useState([]),[r,b]=o.useState(null),[u,E]=o.useState([]),[L,B]=o.useState(!1),$=s=>{switch(c.language){case"zh-TW":return s.zhTW||s.english;case"zh-CN":return s.zhCN||s.english;default:return s.english}},O=()=>{const s=n.filter(f=>f.tagalog.length>=3&&f.tagalog.length<=12&&!f.tagalog.includes(" ")),a=S(s).slice(0,h);E(a),w(0),I(0),m([]),b(null),B(!1)};o.useEffect(()=>{if(u.length===0){O();return}if(t<u.length){const s=u[t];y(T(s.tagalog)),m([]),b(null)}},[t,u]);const i=u[t],p=d.map(s=>x[s]).join("");o.useEffect(()=>{if(!(!i||r!==null)&&p.length===i.tagalog.length){const s=p===i.tagalog;b(s?"correct":"incorrect"),s&&I(a=>a+1),setTimeout(()=>{t+1>=h?B(!0):w(a=>a+1)},1200)}},[p,i,r,t]);const H=s=>{r===null&&(d.includes(s)?m(a=>a.filter(f=>f!==s)):m(a=>[...a,s]))},M=()=>{r===null&&m([])},W=()=>{r!==null||!i||(y(T(i.tagalog)),m([]))};if(L){const s=Math.round(j/h*100);return e.jsxs(N,{children:[e.jsx(k,{title:l("scramble.title"),showBackButton:!0,defaultHref:"/home"}),e.jsx(v,{className:"ion-padding scramble-content",children:e.jsxs("div",{className:"scramble-over-container fade-in-up",children:[e.jsxs("div",{className:"scramble-over-card",children:[e.jsx("div",{className:"trophy-icon",children:e.jsx(C,{icon:A})}),e.jsx("h2",{children:l("scramble.complete")}),e.jsx("p",{className:"scramble-over-subtitle",children:l("scramble.greatUnscrambling")}),e.jsxs("div",{className:"score-grid",children:[e.jsxs("div",{className:"score-item",children:[e.jsx("div",{className:"score-label",children:l("game.finalScore")}),e.jsxs("div",{className:"score-value",children:[j,"/",h]})]}),e.jsxs("div",{className:"score-item",children:[e.jsx("div",{className:"score-label",children:l("game.accuracy")}),e.jsxs("div",{className:"score-value accent",children:[s,"%"]})]})]}),e.jsxs(g,{expand:"block",className:"play-again-btn",onClick:O,children:[e.jsx(C,{icon:G,slot:"start"}),l("game.playAgain")]}),e.jsx(g,{expand:"block",fill:"outline",routerLink:"/home",className:"home-btn",children:l("review.backToHome")})]}),e.jsx(F,{})]})})]})}return i?e.jsxs(N,{children:[e.jsx(k,{title:l("scramble.title"),showBackButton:!0,defaultHref:"/home"}),e.jsx(v,{className:"ion-padding scramble-content",children:e.jsxs("div",{className:"scramble-container",children:[e.jsxs("div",{className:"scramble-progress",children:[e.jsx("div",{className:"progress-bar",children:e.jsx("div",{className:"progress-fill",style:{width:"".concat(t/h*100,"%")}})}),e.jsxs("div",{className:"progress-text",children:[t+1," / ",h]})]}),e.jsx("div",{className:"scramble-stats",children:e.jsxs("div",{className:"stat-item",children:[e.jsx("span",{className:"stat-label",children:l("game.score")}),e.jsx("span",{className:"stat-value",children:j})]})}),e.jsxs("div",{className:"scramble-card ".concat(r==="correct"?"correct":""," ").concat(r==="incorrect"?"incorrect":""),children:[e.jsx("div",{className:"scramble-prompt-label",children:l("scramble.unscramble")}),e.jsx("h2",{className:"scramble-prompt",children:$(i)})]}),e.jsxs("div",{className:"answer-display",children:[e.jsx("div",{className:"answer-slots",children:i.tagalog.split("").map((s,a)=>e.jsx("div",{className:"answer-slot ".concat(d[a]!==void 0?"filled":""," ").concat(r),children:d[a]!==void 0?x[d[a]]:""},a))}),r==="incorrect"&&e.jsxs("div",{className:"correct-answer",children:[l("scramble.correctWas")," ",e.jsx("strong",{children:i.tagalog})]})]}),e.jsx("div",{className:"scrambled-letters",children:x.map((s,a)=>e.jsx("button",{className:"letter-tile ".concat(d.includes(a)?"selected":""),onClick:()=>H(a),disabled:r!==null,children:s},a))}),e.jsxs("div",{className:"action-buttons",children:[e.jsx(g,{fill:"outline",onClick:M,disabled:d.length===0||r!==null,children:l("scramble.clear")}),e.jsxs(g,{fill:"outline",onClick:W,disabled:r!==null,children:[e.jsx(C,{icon:R,slot:"start"}),l("scramble.shuffle")]})]})]})})]}):e.jsxs(N,{children:[e.jsx(k,{title:l("scramble.title"),showBackButton:!0,defaultHref:"/home"}),e.jsx(v,{className:"ion-padding scramble-content",children:e.jsx("div",{className:"loading-container",children:e.jsx("p",{children:l("game.loading")})})})]})};export{K as default};

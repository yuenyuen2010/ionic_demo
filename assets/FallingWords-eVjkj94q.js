import{u as E,r as a,x as G,j as s,I as P,b as K,c as i,e as g}from"./index-BLtOpwuz.js";import{B as w,G as F,H as V,I as Y,r as _,h as $}from"./index-CEQkXYGf.js";import{C as q}from"./CommonHeader-CVm9cG9x.js";import{l as J}from"./lessons-DH3gilkg.js";const Q=()=>J.flatMap(t=>t.cards),y=t=>{const o=[...t];for(let l=o.length-1;l>0;l--){const c=Math.floor(Math.random()*(l+1));[o[l],o[c]]=[o[c],o[l]]}return o},es=()=>{const{t,i18n:o}=E(),[l,c]=a.useState(!1),[d,p]=a.useState(!1),[m,v]=a.useState(0),[h,N]=a.useState(3),[f,A]=a.useState(null),[I,O]=a.useState([]),[S,C]=a.useState(5e3),[M,R]=a.useState(0),T=a.useRef(Q()),W=a.useRef(null),x=a.useCallback(e=>{switch(o.language){case"zh-TW":return e.zhTW||e.english;case"zh-CN":return e.zhCN||e.english;default:return e.english}},[o.language]),b=()=>{v(0),N(3),C(5e3),c(!0),p(!1),j(!0)},j=a.useCallback((e=!1)=>{if(!e&&!l&&m===0&&h===3)return;const n=T.current,u=n[Math.floor(Math.random()*n.length)];A(u);const H=x(u),L=n.filter(r=>r.id!==u.id),D=y(L).slice(0,3).map(r=>x(r));O(y([H,...D])),R(r=>r+1),m>0&&m%5===0&&C(r=>Math.max(1500,r*.9))},[x,l,h,m]),z=e=>{if(!f||d)return;const n=x(f);e===n?(v(u=>u+1),j()):k()},k=a.useCallback(()=>{d||(N(e=>{const n=e-1;return n<=0&&(p(!0),c(!1)),n}),h>1&&j())},[d,h,j]),B=()=>{k()};return G(()=>{c(!1)}),s.jsxs(P,{children:[s.jsx(q,{title:t("falling.title"),showBackButton:!0,defaultHref:"/home"}),s.jsxs(K,{className:"falling-content",scrollY:!1,children:[!d&&l&&s.jsxs("div",{className:"game-area",ref:W,children:[s.jsxs("div",{className:"game-stats-bar",children:[s.jsxs("div",{className:"stat-box",children:[s.jsx(i,{icon:w}),s.jsx("span",{children:m})]}),s.jsx("div",{className:"stat-box lives",children:[...Array(3)].map((e,n)=>s.jsx(i,{icon:F,className:n<h?"life-active":"life-lost"},n))})]}),f&&s.jsx("div",{className:"falling-word-container",style:{animationDuration:"".concat(S,"ms")},onAnimationEnd:B,children:s.jsx("div",{className:"falling-word-bubble",children:f.tagalog})},M),s.jsx("div",{className:"options-dock",children:I.map((e,n)=>s.jsx("button",{className:"option-tile",onClick:()=>z(e),children:e},n))})]}),!l&&!d&&s.jsx("div",{className:"splash-screen",children:s.jsxs("div",{className:"splash-content",children:[s.jsx("div",{className:"icon-circle",children:s.jsx(i,{icon:V})}),s.jsx("h1",{children:t("falling.title")}),s.jsx("p",{children:t("falling.description")}),s.jsxs(g,{expand:"block",shape:"round",className:"start-btn",onClick:b,children:[s.jsx(i,{icon:Y,slot:"start"}),t("common.start")]})]})}),d&&s.jsx("div",{className:"game-over-screen",children:s.jsxs("div",{className:"game-over-content",children:[s.jsx(i,{icon:w,className:"result-trophy"}),s.jsx("h2",{children:t("common.gameOver")}),s.jsxs("div",{className:"final-score-display",children:[s.jsx("span",{children:t("common.score")}),s.jsx("strong",{children:m})]}),s.jsxs("div",{className:"action-buttons",children:[s.jsxs(g,{expand:"block",onClick:b,children:[s.jsx(i,{icon:_,slot:"start"}),t("common.playAgain")]}),s.jsxs(g,{expand:"block",fill:"outline",routerLink:"/home",children:[s.jsx(i,{icon:$,slot:"start"}),t("common.backToHome")]})]})]})})]})]})};export{es as default};

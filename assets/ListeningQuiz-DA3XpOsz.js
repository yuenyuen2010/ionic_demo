import{u as R,r as i,j as e,I as _,b as B,c as f,e as H}from"./index-DmI7GXTK.js";import{o as G,v as q,E as z,F,r as J,h as U}from"./index-CEQkXYGf.js";import{C as D}from"./CommonHeader-CU3qHxhW.js";import{l as K}from"./lessons-DH3gilkg.js";const V=()=>{const n=[];return K.forEach(t=>{t.cards.forEach(o=>{o.tagalog.split(" ").length<=3&&n.push({tagalog:o.tagalog,english:o.english})})}),n},A=n=>{const t=[...n];for(let o=t.length-1;o>0;o--){const h=Math.floor(Math.random()*(o+1));[t[o],t[h]]=[t[h],t[o]]}return t},u=10,se=()=>{const{t:n}=R(),t=i.useRef(null),[o,h]=i.useState([]),[g,E]=i.useState(0),[p,I]=i.useState(0),[c,v]=i.useState(null),[m,b]=i.useState(null),[w,P]=i.useState(!1),[x,j]=i.useState(!1),[N,C]=i.useState(!1),O=i.useCallback(()=>{const s=V();return A(s).slice(0,u).map(d=>{const y=A(s.filter(L=>L.tagalog!==d.tagalog)).slice(0,3),T=A([d,...y]);return{word:d,options:T}})},[]),S=i.useCallback(()=>{const s=O();h(s),E(0),I(0),v(null),b(null),P(!1),C(!1)},[O]);i.useEffect(()=>{S()},[S]);const r=o[g],$=async()=>{var l;if(!r||x)return;j(!0),C(!0);const s=r.word.tagalog;try{const y=(l=(await(await fetch("/ionic_demo/audio/audio-map.json")).json())[s])==null?void 0:l.normal;if(y){const T="/ionic_demo/".concat(y);if(t.current){t.current.src=T,t.current.onended=()=>j(!1),t.current.onerror=()=>k(s),await t.current.play().catch(()=>k(s));return}}}catch(a){}k(s)},k=async s=>{try{const l=await fetch("/.netlify/functions/tts",{method:"POST",headers:{"Content-Type":"application/json"},body:JSON.stringify({text:s,languageCode:"fil-PH"})});if(l.ok){const a=await l.json();if(a.audioContent){const d=new Audio("data:audio/mp3;base64,".concat(a.audioContent));d.onended=()=>j(!1),d.play()}}}catch(l){console.error("TTS failed:",l)}finally{j(!1)}};i.useEffect(()=>{if(r&&!w){const s=setTimeout(()=>{$()},500);return()=>clearTimeout(s)}},[g,o]);const M=s=>{if(c!==null||!N)return;v(s);const l=s===r.word.tagalog;b(l),l&&I(a=>a+1),setTimeout(()=>{g+1>=u?P(!0):(E(a=>a+1),v(null),b(null),C(!1))},2e3)},Q=()=>{const s=p/u*100;return s===100?"üèÜ":s>=80?"üåü":s>=60?"üòä":s>=40?"üí™":"üìö"},W=()=>{const s=p/u*100;return s===100?n("listening.perfect"):s>=80?n("listening.excellent"):s>=60?n("listening.good"):s>=40?n("listening.keepLearning"):n("listening.tryAgain")};return!r&&!w?null:e.jsxs(_,{children:[e.jsx(D,{title:n("listening.title"),showBackButton:!0,defaultHref:"/home"}),e.jsx("audio",{ref:t}),e.jsx(B,{className:"listening-game-content",children:w?e.jsx("div",{className:"listening-game-over",children:e.jsxs("div",{className:"game-over-card",children:[e.jsx("div",{className:"score-emoji",children:Q()}),e.jsx("h2",{className:"score-title",children:W()}),e.jsx("div",{className:"final-score",children:e.jsxs("div",{className:"score-circle",children:[e.jsx("span",{className:"score-number",children:p}),e.jsxs("span",{className:"score-total",children:["/ ",u]})]})}),e.jsxs("div",{className:"game-over-actions",children:[e.jsxs(H,{expand:"block",onClick:S,className:"play-again-btn",children:[e.jsx(f,{icon:J,slot:"start"}),n("listening.playAgain")]}),e.jsxs(H,{expand:"block",fill:"outline",routerLink:"/home",className:"home-btn",children:[e.jsx(f,{icon:U,slot:"start"}),n("common.backToHome")]})]})]})}):e.jsxs("div",{className:"listening-game-container",children:[e.jsx("div",{className:"listening-progress-bar",children:e.jsx("div",{className:"listening-progress-fill",style:{width:"".concat((g+1)/u*100,"%")}})}),e.jsxs("div",{className:"listening-stats-row",children:[e.jsxs("div",{className:"listening-stat",children:[e.jsx("span",{className:"stat-label",children:n("listening.question")}),e.jsxs("span",{className:"stat-value",children:[g+1,"/",u]})]}),e.jsxs("div",{className:"listening-stat",children:[e.jsx("span",{className:"stat-label",children:n("listening.score")}),e.jsx("span",{className:"stat-value",children:p})]})]}),e.jsxs("div",{className:"audio-player-card",children:[e.jsx("button",{className:"play-audio-btn ".concat(x?"playing":""),onClick:$,disabled:x,children:e.jsx(f,{icon:x?G:q})}),e.jsx("p",{className:"audio-hint",children:n(N?"listening.tapAgain":"listening.tapToListen")})]}),e.jsx("div",{className:"listening-options-grid",children:r.options.map((s,l)=>{let a="listening-option";return c!==null&&(s.tagalog===r.word.tagalog?a+=" correct":s.tagalog===c&&!m?a+=" wrong":a+=" faded"),N||(a+=" disabled"),e.jsxs("button",{className:a,onClick:()=>M(s.tagalog),disabled:c!==null||!N,children:[e.jsx("span",{className:"option-tagalog",children:s.tagalog}),e.jsx("span",{className:"option-english",children:s.english}),c!==null&&s.tagalog===r.word.tagalog&&e.jsx(f,{icon:z,className:"result-icon correct"}),c===s.tagalog&&!m&&e.jsx(f,{icon:F,className:"result-icon wrong"})]},l)})}),c!==null&&e.jsxs("div",{className:"listening-feedback ".concat(m?"correct":"wrong"),children:[e.jsx("span",{className:"feedback-emoji",children:m?"‚úÖ":"‚ùå"}),e.jsx("span",{className:"feedback-text",children:m?n("listening.correct"):"".concat(n("listening.wrong")," ").concat(r.word.tagalog)})]})]})})]})};export{se as default};
